<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Blockly Demo: Resizable Blockly (Part 2)</title>
  <script src="node_modules/blockly/blockly_compressed.js"></script>
  <script src="node_modules/blockly/javascript_compressed.js"></script>
  <!-- Custom blocks -->
  <script src="blocks.js"></script>
  <!-- Code generators for the custom blocks -->
  <script src="generator.js"></script>
  <script src="node_modules/blockly/msg/en.js"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    body {
      background-color: #fff;
      font-family: sans-serif;
      overflow: scroll;
    }
    h1 {
      font-weight: normal;
      font-size: 140%;
    }
    .column {
      float: left;
      padding: 5px;
    }
    .row::after {
      content: "";
      clear: both;
      display: table;
    }
    textarea {
      width: 600px;
      height: 600px;
      vertical-align: top;
      overflow: scroll;
    }
  </style>
</head>
<body>
  <div class="row">
    <p>
      Matthew Christopher Hawkins - Project
    </p>
    <p>
      <button onclick="showCode()">Show JavaScript</button>
      <button onclick="runCode()">Run JavaScript</button>
    </p>
    <div class = "column">
      <div id="blocklyDiv" style="height: 600px; width: 800px;"></div>
    </div>
    <div class = "column">
      <textarea type="text" id="code_output" value="" readonly></textarea>
    </div>
  </div>

  <script>
    //REMEMBER TO ADD ALL NEW BLOCKS TO THE TOOL BOX <------------------
    var toolbox = {
        "kind":"categoryToolbox",
        "contents": [
          {
            "kind": "category",
            "name":"Logic",
            "categorystyle":"logic_category",
            "contents":[
              {
                "kind": "block",
                "type": "if_statement"
              },
              {
                "kind": "block",
                "type": "compound_statement"
              }
            ]
          },
          {
            "kind": "category",
            "name":"Text",
            "categorystyle":"text_category",
            "contents":[
              {
                "kind": "block",
                "type": "print_statement"
              },
              {
                "kind": "block",
                "type": "string_length"
              },
              {
                "kind": "block",
                "type": "text"
              }
            ]
          },
          {
            "kind": "category",
            "name":"Maths",
            "categorystyle":"math_category",
            "contents":[
              {
                "kind": "block",
                "type": "simple_maths"
              },
              {
                "kind": "block",
                "type": "compare"
              },
              {
                "kind": "block",
                "type": "number"
              }
            ]
          },
          {
            "kind": "category",
            "name":"Everything else",
            "categorystyle":"math_category",
            "contents":[
              {
                "kind": "block",
                "type": "dummy"
              },
              {
                "kind": "block",
                "type": "num_to_string"
              }
            ]
          },
          {
            "kind":"category",
            "name":"Variables",
            "categorystyle":"variable_category",
            "contents":[
              {
                "kind": "button",
                "text": "A button",
                "callbackKey": "myFirstButtonPressed"
              },
              {
                "kind": "block",
                "type": "variables_get"
              },
              {
                "kind": "block",
                "type": "variables_set"
              }
            ]
          }
        ]
      };

    var demoWorkspace = Blockly.inject(blocklyDiv,
        {toolbox : toolbox, 
        collapse : true, 
        comments : true, 
        disable : false, 
        maxBlocks : Infinity, 
        trashcan : true, 
        horizontalLayout : false, 
        toolboxPosition : 'start', 
        css : true, 
        media : 'https://unpkg.com/blockly/media/', 
        rtl : false, 
        scrollbars : true, 
        sounds : true, 
        oneBasedIndex : true, 
        grid : {
          spacing : 20, 
          length : 1, 
          colour : '#888', 
          snap : true}
        });
    //var codeDiv = document.getElementById('code_output').firstChild;

    demoWorkspace.registerButtonCallback('myFirstButtonPressed', function(button) {
      Blockly.Variables.createVariableButtonHandler(button.getTargetWorkspace(), null, 'String');
    });

    function showCode() {
      // Generate JavaScript code and display it.
      Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
      var code = Blockly.JavaScript.workspaceToCode(demoWorkspace);
      // alert(code);
      document.getElementById("code_output").value = code;
    }

    function runCode() {
      // Generate JavaScript code and run it.
      window.LoopTrap = 1000;
      Blockly.JavaScript.INFINITE_LOOP_TRAP =
          'if (--window.LoopTrap == 0) throw "Infinite loop.";\n';
      var code = Blockly.JavaScript.workspaceToCode(demoWorkspace);
      Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
      try {
        eval(code);
      } catch (e) {
        alert(e);
      }
    }
  </script>

</body>
</html>
